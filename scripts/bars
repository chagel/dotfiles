#!/bin/sh

pmusic() {
  if pgrep -x "ncspot" > /dev/null
  then
    if [[ "$(playerctl status)" = "Playing" ]]; then
      ARTIST=$(playerctl metadata artist)
      TITLE=$(playerctl metadata title)
      echo -e "\uf001 $ARTIST - $TITLE"
    fi
  fi
}

pmail() {
  COUNT=$(notmuch count tag:unread)
  echo -e "\uf0e0 $COUNT"
}

pcal() {
  COUNT=$(cat $HOME/.config/calendar.tsv | grep "$(date "+%Y-%m-%d")" | wc -l) 
  echo -e "\uf073 $COUNT"
}

ptasks() {
  COUNT=$(task +OVERDUE or due:eod or due:tomorrow -COMPLETED count)
  echo -e "\uf024 $COUNT"
}

ptimew() {
  INTERVAL=$(timew | awk '/Total/{print $2}')
  if [[ -n "$INTERVAL" ]]; then
    echo -e "\uf017 $INTERVAL"
  fi
}

pcst() {
  echo "CST $(TZ='Asia/Shanghai' date +%H:%M)"
}

case "$1" in
  music) pmusic;;
  mail)  pmail;;
  cal)   pcal;;
  tasks) ptasks;;
  timew) ptimew;;
  cst) pcst;;
  # *) ;;
esac

